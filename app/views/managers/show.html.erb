<div class="col-xs-12" ng-controller="ManagerShowController"
     ng-init="init(<%= @manager.hosts.to_json(:include => [:user, :witness, :city]) %>,
                   <%= @manager.witnesses.to_json(:include => :city) %>)">

  <!-- View toggle buttons -->
  <div class="text-center margin-bottom-20">
    <div class="view-toggle">
      <div ng-class="{ 'selected': activeView === 'hosts' }"
           ng-click="onViewToggle('hosts')"><%= t '.hosts_view' %></div>
      <div ng-class="{ 'selected': activeView === 'witnesses' }"
           ng-click="onViewToggle('witnesses')"><%= t '.witnesses_view' %></div>
    </div>
  </div>
  
  <!-- Host view -->
  <div class="row" ng-if="activeView === 'hosts'">
    <div class="col-xs-12">
      <!-- Host filters -->
      <form class="form-inline">
        <span><%= t 'shared.filter_by' %></span>

        <div class="form-group">
          <select class="form-control" ng-model="search.host.city_id"
                  ng-options="o.id as o.name for o in cities">
            <option value=""><%= t 'shared.city' %></option>
          </select>
        </div> 

        <div class="form-group">
          <select class="form-control" ng-model="search.host.survivor_needed"
                  ng-options="o.v as o.n for o in [{ n: '<%= t 'shared.needs' %>', v: true }, { n: '<%= t 'shared.doesnt_need' %>', v: false }]">
            <option value=""><%= t 'shared.survivor_needed' %></option>
          </select>
        </div> 

        <div class="form-group">
          <select class="form-control" ng-model="search.host.has_survivor"
                  ng-options="o.v as o.n for o in [{ n: '<%= t 'shared.teamed' %>', v: true }, { n: '<%= t 'shared.not_teamed' %>', v: false }]">
            <option value=""><%= t 'shared.has_survivor' %></option>
          </select>
        </div>  

        <div class="form-group">
          <select class="form-control" ng-model="search.host.contacted"
                  ng-options="o.v as o.n for o in [{ n: '<%= t 'shared.yes' %>', v: true }, { n: '<%= t 'shared.no' %>', v: false }]">
            <option value=""><%= t 'shared.host_contacted' %></option>
          </select>
        </div>  

        <div class="form-group pull-left">
          <input type="text" class="form-control" ng-model="search.host.query" placeholder="חיפוש חופשי" />
        </div>
      </form>

      <!-- Host table -->
      <table class="table host-table">
        <thead>
          <tr>
            <th><%= t 'shared.name' %></th>
            <th><%= t 'shared.registration_time' %></th>
            <th><%= t 'shared.city' %></th>
            <th><%= t 'shared.evening_date' %></th>
            <th><%= t 'shared.hosted_before' %></th>
            <th><%= t 'shared.host_contacted' %></th>
            <th><%= t 'shared.survivor_needed' %></th>
            <th><%= t 'shared.has_survivor' %></th>
            <th><%= t 'shared.strangers_allowed' %></th>
          </tr> 
        </thead>
        <tbody>
          <tr ng-repeat="host in filterHosts(hosts)" ng-click="editHost(host)">
            <td>{{ host.user.full_name }}</td>
            <td>{{ formatDateTime(host.created_at) }}</td>
            <td>{{ host.city.name }}</td>
            <td>{{ formatDate(host.event_date) }}</td>
            <td>{{ formatBool(!host.hosted_before) }}</td>
            <td>{{ formatBool(host.contacted) }}</td>
            <td>{{ formatBool(host.survivor_needed) }}</td>
            <td>{{ formatBool(host.has_survivor) }}</td>
            <td>{{ formatBool(host.strangers) }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div> 
  <!-- End of host view -->


  <!-- Witness view -->
  <div class="row" ng-if="activeView === 'witnesses'">
    <div class="col-xs-12">
      <div class="pull-left">
        <%= link_to new_witness_path do %>
          <span class="glyphicon glyphicon-plus"></span>
          <span><%= t '.add_witness' %></span>
        <% end %>
      </div>
    </div>
    <div class="col-xs-12">
      <!-- Witness filters -->
      <form class="form-inline">
        <span><%= t 'shared.filter_by' %>:</span>

        <div class="form-group">
          <select class="form-control" ng-model="search.witness.witness_type"
                  ng-options="o.v as o.n for o in witnessTypes">
            <option value=""><%= t 'shared.type' %></option>
          </select>
        </div> 

        <div class="form-group">
          <select class="form-control" ng-model="search.witness.stairs"
                  ng-options="o.v as o.n for o in [{ n: '<%= t 'shared.can' %>', v: true }, { n: '<%= t 'shared.cant' %>', v: false }]">
            <option value=""><%= t 'shared.walk_up_stairs' %></option>
          </select>
        </div> 

        <div class="form-group">
          <select class="form-control" ng-model="search.witness.seminar_required"
                  ng-options="o.v as o.n for o in [{ n: '<%= t 'shared.interested' %>', v: true }, { n: '<%= t 'shared.not_interested' %>', v: false }]">
            <option value=""><%= t 'shared.seminar_required' %></option>
          </select>
        </div>  

        <div class="form-group">
          <select class="form-control" ng-model="search.witness.concept"
                  ng-options="o.v as o.n for o in [
                    { n: '<%= t 'shared.concept.religious_and_secular' %>', v: 'religious_and_secular' },
                    { n: '<%= t 'shared.concept.vetrans' %>', v: 'vetrans' },
                    { n: '<%= t 'shared.concept.eastern' %>', v: 'eastern' }
                  ]">
            <option value=""><%= t 'shared.concept_label' %></option>
          </select>
        </div>  

        <div class="form-group pull-left">
          <input type="text" class="form-control" ng-model="search.witness.query"
                 placeholder="<%= t 'shared.search' %>" />
        </div>
      </form>

      <!-- Host table -->
      <table class="table witness-table">
        <thead>
          <tr>
            <th><%= t 'shared.name' %></th>
            <th><%= t 'shared.city' %></th>
            <th><%= t 'shared.type' %></th>
            <th><%= t 'shared.date' %></th>
            <th><%= t 'shared.walk_up_stairs' %></th>
            <th><%= t 'shared.seminar_required' %></th>
            <th><%= t 'shared.concept_label' %></th>
            <th><%= t 'shared.special_population' %></th>
          </tr> 
        </thead>
        <tbody>
          <tr ng-repeat="witness in filterWitnesses(witnesses)"
              ng-click="editWitness(witness)">
            <td>{{ witness.full_name }}</td>
            <td>{{ witness.city.name }}</td>
            <td>{{ witness.witness_type }}</td>
            <td>{{  }}</td>
            <td>{{ formatBool(witness.stairs) }}</td>
            <td>{{ formatBool(witness.seminar_required) }}</td>
            <td>{{ witness.concept }}</td>
            <td>{{ formatBool(witness.special_population) }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div> 
  <!-- End of host view -->


</div>


<script type="text/ng-template" id="witness-popup.html">
  <div class="modal-header">
    <h3 class="modal-title">בחר איש עדות</h3>
  </div>
  <div class="modal-body">
      <table class="table host-table">
        <thead>
          <tr>
            <th>שם</th>
            <th>עיר</th>
            <th>שפה</th>
            <th>יכול מדרגות</th>
            <th>צריך סמינר</th>
            <th>אוכלוסיה מיוחדת</th>

          </tr> 
        </thead>
        <tbody>
          <tr ng-repeat="witness in witnesses" ng-click="selectWitness(witness)">
            <td>{{ witness.full_name }}</td>
            <td>{{ witness.city.name }}</td>
            <td>{{ witness.language }}</td>
            <td>{{ formatBool(witness.stairs) }}</td>
            <td>{{ formatBool(witness.seminar_required) }}</td>
            <td>{{ formatBool(witness.special_population) }}</td>
          </tr>
        </tbody>
      </table>

      <p>
        צוות את: {{ selected.witness.full_name }}
      </p>
  </div>
  <div class="modal-footer">
      <button class="btn btn-primary" type="button" ng-click="ok()">אישור</button>
      <button class="btn btn-warning" type="button" ng-click="cancel()">ביטול</button>
  </div>
</script>